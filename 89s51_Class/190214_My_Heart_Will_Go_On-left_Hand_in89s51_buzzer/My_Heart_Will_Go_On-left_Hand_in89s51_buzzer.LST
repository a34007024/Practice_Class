C51 COMPILER V9.01   MY_HEART_WILL_GO_ON_LEFT_HAND_IN89S51_BUZ                             02/14/2019 12:04:24 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE MY_HEART_WILL_GO_ON_LEFT_HAND_IN89S51_BUZ
OBJECT MODULE PLACED IN My_Heart_Will_Go_On-left_Hand_in89s51_buzzer.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE My_Heart_Will_Go_On-left_Hand_in89s51_buzzer.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include <reg51.h>
   2          #define  B0 50000               // 定義基本節拍
   3          sbit Buzzer=P3^7;               // 宣告蜂鳴器位址 
   4          unsigned int code BaseTone[37]={        // 宣告基本音階陣列
   5          // 中音 
   6          //  0   1               2               3               4               5               6               7
   7                  1,      956,    852,    759,    716,  638,      568,    506,
   8          //  8   9       10
   9                  1,      1, 1,
  10          // 低音 
  11          //  11          12              13              14              15              16              17
  12                  1908,   1701,   1515,   1433,   1276,   1136,   1012,
  13          //  18  19      20
  14                  1,      1, 1,
  15          // 高音 
  16          //  21          22              23              24              25              26              27
  17                  478,    426,    379,    358,    319,    284,    253,
  18          //  28  29      30
  19                  1,      1, 1,
  20          // 中音(Do#, Re#,-,Fa#,So#,La# ) 
  21          //  31          32              33              34              35              36              
  22                  903,    804,    1,              676,    602,    526     };
  23          /*// 點仔膠 音調表 
  24          char code SONG[]={
  25                  6,6,6,          5,3,6,  22,21,22,       6,5,6,                  //1     
  26                  21,21,22,23,23,22,22,21,21,6,6, 5,7,6,  100};   //2
  27          // 點仔膠 節拍表 
  28          char code BEAT[]={
  29                  4,4,6,          4,4,6,  4,4,6,          4,4,6,          //1
  30                  4,4,6,2,        4,4,6,  4,4,4,4,        4,4,6};         //2
  31          //========================================*/
  32          // flower dance 音調表 
  33          char code SONG[]={
  34                  0,0,0,1,2,      3,2,1,  2,5,4,3,        1,16,
  35                  15,1,2,         2,3,3,4,3,2,1,          2,5,3,5,        6,5,
  36                  2,3,2,2,0,              1,1,1,1,        17,1,1,         17,1,2,
  37                  3,2,    1,1,1,1,        17,1,1,         15,
  38                  0,0,14,15,16,17,        1,1,1,1,        17,1,1,         17,1,2,
  39                  3,4,3,2,        1,1,1,1,        17,1,1,         15,
  40                  0,0,0,0,        1,              2,15,           5,4,3,
  41                  2,3,4,          3,2,1,          17,1,17,        16,
  42                  15,13,15,16,17,         1,              2,5,    5,4,3,
  43                  2,3,4,          3,2,1,          17,1,17,        17,1,2,
  44                  3,2,1,2,        3,2,1,          2,5,4,3,        1,16,
  45                  15,1,2,         2,3,3,4,3,2,1,          2,5,3,5,6,6
  46                  ,100}; //100為空的陣列格，表示歌曲結尾
  47          // flower dance 節拍表 
  48          char code BEAT[]={
  49                  1,1,1,4,4,      24,4,4, 8,16,4,4,       24,8,
  50                  24,4,4,         4,12,4,2,2,4,4,         8,16,4,4,       16,16,
  51                  2,2,12,12,1,    12,4,8,8,       8,16,8,         8,16,8,
  52                  16,16,  12,4,8,8,       8,16,8,         32,
  53                  1,1,4,4,4,4,            12,4,8,8,       8,16,8,         8,16,8,
  54                  16,2,2,12,      12,4,8,8,       8,16,8,         32,
  55                  1,1,1,1,        32,             24,8,           16,8,8,
C51 COMPILER V9.01   MY_HEART_WILL_GO_ON_LEFT_HAND_IN89S51_BUZ                             02/14/2019 12:04:24 PAGE 2   

  56                  16,8,8,         16,8,8,         8,16,8,         32,
  57                  16,4,4,4,4,                     32,             24,8,   16,8,8,
  58                  16,8,8,         16,8,8,         8,16,8,         8,16,8,
  59                  16,8,4,4,       24,4,4,         8,16,4,4,       24,8,
  60                  24,4,4,         4,12,4,2,2,4,4,         8,16,4,4,32,32
  61                  };
  62          //========================================
  63          int t0H,t0L;                    // 宣告變數
  64          void beat(char);                // 宣告節拍函數
  65          void DELAY(int);                // 宣告延時函數
  66          void DELAY1ms(int);     // 宣告延時函數
  67          // ==================================================
  68          main()
  69          {       unsigned char i;        // 宣告播歌指標
  70   1              Buzzer=1;                       // 初始化
  71   1              IE=0x82;                        // 啟用Timer 0中斷
  72   1              TMOD=TMOD|1;            // 設定Timer 0 Mode 1
  73   1              while(1)                        // 若開關on
  74   1              {       i=0;                    // 若播歌指標歸零
  75   2                      TR0=1;                  // 開始播歌
  76   2                      while(SONG[i]!=100)     // 若非結束符號，則播歌
  77   2                      {       TH0=t0H=(65536-BaseTone[SONG[i]])/256;
  78   3                              // 載入所要播音階之高8位元
  79   3                              TL0=t0L=(65536-BaseTone[SONG[i]])%256;
  80   3                              // 載入所要播音階之低8位元
  81   3                              beat(BEAT[i]);  // 等待節拍結束
  82   3                              i++;                    // 下一個音
  83   3                      }
  84   2                      TR0=0;                          // 停止播放 
  85   2                      DELAY1ms(30000);        // 等30秒
  86   2              } 
  87   1      } 
  88          // ==================================================
  89          void beat(char x)
  90          {       char i;
  91   1              for (i=0;i<x;i++)
  92   1                      DELAY((B0-23)/12);      
  93   1      }       
  94          // ==================================================
  95          void DELAY1ms(int x)    // 宣告延時函數
  96          {       int i,j;
  97   1              for(i=0;i<x;i++)
  98   1                      for(j=0;j<120;j++);
  99   1      }
 100          // ==================================================
 101          void DELAY(int x)
 102          {       int i;
 103   1              for(i=0;i<x;i++);
 104   1      }
 105          // ==================================================
 106          void TONE_int(void) interrupt 1
 107          {       TH0=t0H; TL0=t0L;       // 重新填入計時量
 108   1              Buzzer=!Buzzer;         // 切換蜂鳴器
 109   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    285    ----
   CONSTANT SIZE    =    385    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      4       3
C51 COMPILER V9.01   MY_HEART_WILL_GO_ON_LEFT_HAND_IN89S51_BUZ                             02/14/2019 12:04:24 PAGE 3   

   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
