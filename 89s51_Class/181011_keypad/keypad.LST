C51 COMPILER V9.01   KEYPAD                                                                10/11/2018 14:08:23 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE KEYPAD
OBJECT MODULE PLACED IN keypad.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE keypad.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /*
   2          接線說明:
   3          a -> P0.0 (P0^0) a為LSB(最低位元)
   4          b -> P0.1
   5          依序a,b,c,d,e,f,g......
   6          最後為dp -> P0.7 dp為MSB(最高位元)
   7          D0 -> P1^0為LSB
   8          依序接線
   9          D3 -> P1^3為MSB
  10          */
  11          #include<reg51.h>
  12          #define seg7Output P0
  13          #define keyInput P2
  14          sbit seg7dp = P0^7;
  15          sbit Buzzer = P3^7;
  16          char seg7hexCode[20] = {0xc0,0xf9,0xa4,0xb0,0x99,0x92,0x82,0xf8,0x80,0x98,0xa0,0x83,0xa7,0xa1,0x86,0x8e,0x
             -ff};
  17          char SCAN_CODE[8]={     0x7f,0xbf,0xdf,0xef,0xf7,0xfb,0xfd,0xfe };      
  18          char DisplayData[4]={16,16,16,16};
  19          void DELAY500us(int);
  20          void keyscan();
  21          void BEEP(char);
  22          
  23          void main(){
  24   1              while(1){
  25   2                      keyscan();
  26   2              }
  27   1      }
  28          //=== 4x4鍵盤掃瞄函數 ===
  29          void keyscan() {
  30   1              char X,Y,Ycode,Kcode,i;
  31   1              for(X=0;X<4;X++){                       // 掃瞄4行
  32   2                      seg7Output=0xff;                                // 關閉顯示信號(防殘影)
  33   2                      keyInput=SCAN_CODE[X];          // 輸出掃瞄信號
  34   2                      seg7Output=seg7hexCode[DisplayData[X]];         // 輸出顯示信號
  35   2                      Y=~keyInput & 0x0f;                     // 讀取鍵盤  
  36   2                      if      (Y!=0){                 // 若有按鍵被按下 
  37   3                              if(Y==8) Ycode=0;        
  38   3                              else if (Y==4) Ycode=1; 
  39   3                              else if (Y==2) Ycode=2; 
  40   3                              else if (Y==1) Ycode=3; 
  41   3                              Kcode=4*Ycode + X;              // 計算按鍵值
  42   3                              for(i=0;i<3;i++)
  43   3                                      DisplayData[3-i]=DisplayData[2-i];// 顯示資料移位
  44   3                              DisplayData[0]=Kcode;                   // 將鍵值存入個位數
  45   3                              BEEP(1);                                        // 嗶一聲 
  46   3                              while(Y!=0) Y=~keyInput & 0x0f;// 等待放開按鍵
  47   3                      }
  48   2                      DELAY500us(4);                                  // 延遲2ms
  49   2              }
  50   1      }
  51          
  52          void DELAY500us(int time){
  53   1              int i,j;
  54   1              for(i = 0;i<time;i++)
C51 COMPILER V9.01   KEYPAD                                                                10/11/2018 14:08:23 PAGE 2   

  55   1                      for(j=0;j<60;j++);//do nothing
  56   1      }
  57          
  58          //==== 嗶聲函數 ========
  59          void BEEP(char x) 
  60          {       int     i,j;
  61   1              for(i=0;i<x;i++)                                // 嗶x聲
  62   1              {       for(j=0;j<50;j++)               // 重複吸放100次
  63   2                      {       Buzzer=0;DELAY500us(1);// 蜂鳴器吸
  64   3                              Buzzer=1;DELAY500us(1);// 蜂鳴器放
  65   3                      } 
  66   2                      DELAY500us(200);                        // 靜音0.1秒
  67   2              } 
  68   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    261    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     32       5
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
