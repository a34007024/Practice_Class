C51 COMPILER V9.01   A1                                                                    02/11/2012 12:09:02 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE A1
OBJECT MODULE PLACED IN A1.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE A1.C BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include <reg51.h>
   2          #define  B0 50000                       // 定義基本節拍
   3          #define  KEY P2                         // 定義按鍵位址
   4          sbit Buzzer=P3^7;                       // 宣告蜂鳴器位址 
   5          // ========================================
   6          int code BaseTone[37]={ // 宣告基本音階陣列
   7                  1,956,852,759,716,638,568,506,1,1,1,
   8                  1908,1701,1515,1433,1276,1136,1012,1,1,1,
   9                  478,426,379,358,319,284,253,1,1,1,
  10                  903,804,1,676,602,      526     };
  11          // ========================================
  12          // 平安夜,聖誕夜 音調表 
  13          char code song1[]={
  14                  5,6,5,3,        5,6,5,3,        2,22,7,                 21,21,5,        //1
  15                  6,6,21,7,6, 5,6,5,3,    6,6,21,7,6,     5,6,5,3 ,       //2
  16                  22,22,24,22,7, 21,23,   21,5,3,5,4,2,   1,1, 100};      //3
  17          // 平安夜,聖誕夜 節拍表 
  18          char code beat1[]={
  19                  6,2,4,16,       6,2,8,12,       8,4,16,         8,4,16,         //1
  20                  8,8,6,2,8,      6,2,8,16,       8,4,6,2,4,      6,2,4,16,       //2
  21                  8,4,6,2,4,      16,16,          6,2,4,6,2,8,16,16}      ;       //3
  22          // ========================================
  23          // 甜蜜的家庭 音調表  
  24          char code song2[]={
  25                  1,2,            3,4,4,5,        5,3,5,          4,3,4,2,2,      //1     
  26                  3,1,2,          3,4,4,5,        5,3,5,          4,3,4,2 ,       //2
  27                  1,0,5,5,        21,7,6,5,       5,3,5,5,        4,3,4,2 ,       //3
  28                  3,5,5,          21,7,6,5,       5,3,5,5,        4,3,4,2 ,       //4
  29                  1,0,            5,              4,2,            1,                      //5
  30                  2,                      3,0,5,          21,7,6,5,       5,3,5,5,        //6
  31                  4,3,4,2,        1,     100};                                            //7
  32          // 甜蜜的家庭 節拍表 
  33          char code beat2[]={
  34                  12,4,           12,4,12,4,      16,8,8,         12,4,8,4,4,//1
  35                  24,6,2,         12,4,12,4,      16,8,8,         12,4,8,8,       //2
  36                  16,8,4,4,       12,4,12,4, 16,8,4,4,    12,4,8,8,       //3
  37                  24,4,4,         12,4,12,4,      16,8,4,4,       12,4,8,8,       //4
  38                  24,8,           32,             16,16,          32,                     //5
  39                  32,             16,8,8,         12,4,12,4,      16,8,4,4,       //6
  40                  12,4,8,8,       32 };                                                           //7
  41          // ========================================
  42          // You are my Sunshin 音調表 
  43          char code song3[]={
  44                  15,1,2,         3,3,    3,33,2,3,       1,1,            //1     
  45                  1,1,2,3,        4,6,    6,6,5,4,        3,0,            //2
  46                  3,1,2,3,        4,6,    6,6,5,4,        3,1,            //3
  47                  1,15,1,2,       3,4,    2,2,3,1,        1,0, 100};      //4
  48          // You are my Sunshin 節拍表 
  49          char code beat3[]={
  50                  4,4,4,          8,8,    4,4,4,4,        8,8,    //1
  51                  4,4,4,4,        8,8,    4,4,4,4,        12,2,   //2
  52                  4,4,4,4,        8,8,    4,4,4,4,        8,8,    //3
  53                  4,4,4,4,        12,4,   8,4,4,          12,2};  //4
  54          //========================================
  55          // 點仔膠 音調表 
C51 COMPILER V9.01   A1                                                                    02/11/2012 12:09:02 PAGE 2   

  56          char code song4[]={
  57                  6,6,6,          5,3,6,  22,21,22,       6,5,6,                          //1     
  58                  21,21,22,23,23,22,22,21,21,6,6, 5,7,6,  100};   //2
  59          // 點仔膠 節拍表 
  60          char code beat4[]={
  61                  4,4,6,          4,4,6,  4,4,6,          4,4,6,          //1
  62                  4,4,6,2,        4,4,6,  4,4,4,4,        4,4,6};         //2
  63          //========================================
  64          // 西北雨 音調表 
  65          char code song5[]={ 
  66                  6,21,6,         5,3,6,  2,2,1,2,        1,15,16,                //1     
  67                  2,2,3,5,        1,5,6,  5,5,3,5,        2,3,2,                  //2     
  68                  1,16,15,16,1,1,1,       5,5,3,5,        21,5,6,                 //3     
  69                  21,21,21,3,5,6,5,       2,3,2,          17,15,16,100};  //4
  70          // 西北雨 節拍表 
  71          char code beat5[]={
  72                  4,4,8,          4,4,8,  4,4,6,2,        4,4,8,          //1
  73                  4,4,6,2,        4,4,8,  4,4,6,2,        4,4,8,          //2
  74                  4,4,6,2,        4,4,8,  4,4,6,2,        4,4,8,          //3
  75                  4,4,6,2,        4,4,8,  4,4,8,          4,4,8};         //4
  76          //========================================
  77          // 青蚵嫂 音調表
  78          char code song6[]={ 
  79                  16,16,1,2,3,2,          1,16,1,2,13,                    //1     
  80                  15,13,15,16,1,16,2, 1,16,15,13,15,16,   //2     
  81                  16,16,1,2,3,2,          1,16,1,2,13,                    //3     
  82                  15,13,15,16,1,16,2, 1,16,15,13,15,16,   //4     
  83                  15,13,15,16,1,16,2, 1,16,15,13,15,16,   100     };//5   
  84          // 青蚵嫂 節拍表 
  85          char code beat6[]={
  86                  4,4,2,2,12,4,           8,4,4,4,16,             //1
  87                  4,4,4,2,2,12,4,         4,4,4,2,2,16,           //2
  88                  4,4,2,2,12,4,           4,4,4,4,16,             //3
  89                  4,4,4,2,2,12,4,         4,4,4,2,2,16,           //4
  90                  4,4,4,2,2,12,4,         4,4,4,2,2,16};          //5
  91          //========================================
  92          // 寄語白雲 音調表
  93          char code song7[]={ 
  94                  15,15,15,0,1,17,1,      2,2,3,          //1     
  95                  4,4,4,4,3,1,3,                  2,                      //2     
  96                  5,5,5,6,6,6,6,                  5,4,3,2,        //3     
  97                  15,15,15,15,15,4,3,2,   1,                      //4     
  98                  6,6,6,4,                                21,6,5,         //5     
  99                  6,4,21,6,                               5,                      //6     
 100                  4,4,4,3,4,                              5,3,2,1,        //7     
 101                  2,2,2,7,7,7,6,                  5,      100};   //8     
 102          // 寄語白雲 節拍表 
 103          char code beat7[]={
 104                  8,4,4,4,4,4,4,          12,4,16,        //1
 105                  8,4,4,4,8,2,2,          32,                     //2
 106                  8,4,4,4,4,4,4,          8,4,4,16,       //3
 107                  4,4,4,4,4,4,4,4,        32,                     //4
 108                  12,4,8,8,                       8,8,16,         //5
 109                  8,8,8,8,                        32,                     //6
 110                  12,4,8,4,4,             8,4,4,8,        //7
 111                  8,4,4,4,4,4,4,          32};            //8
 112          //========================================              
 113          // 茉莉花 音調表
 114          char code song8[]={ 
 115                  3,3,5,          6,21,21,6,      5,5,6,  5,0,            //1     
 116                  3,3,5,          6,21,21,6,      5,5,6,  5,0,            //2
 117                  5,5,            5,3,5,          6,6,    5,0,            //3
C51 COMPILER V9.01   A1                                                                    02/11/2012 12:09:02 PAGE 3   

 118                  3,2,3,          5,3,2,          1,1,2,  1,0,            //4
 119                  3,2,1,          3,2,3,          5,6,21, 5,                      //5
 120                  2,3,5,          2,3,1,16,       15,             16,1,           //6
 121                  2,3,            1,2,1,16,       15,     0, 100};        //7
 122          // 茉莉花 節拍表 
 123          char code beat8[]={
 124                  8,4,4,          4,4,4,4,        8,4,4,          8,4,    //1
 125                  8,4,4,          4,4,4,4,        8,4,4,          8,4,    //2
 126                  8,8,            8,4,4,          8,8,            8,4,    //3
 127                  8,4,4,          8,4,4,          8,8,            8,4,    //4
 128                  4,4,4,4,        12,4,           8,4,4,          16,             //5
 129                  8,4,4,          4,4,4,4,        16,                     8,8,    //6
 130                  12,4,           4,4,4,4,        16,                     4 };    //7
 131          // ==================================================
 132          int t0H,t0L;            // 宣告變數
 133          char *ptr1,*ptr2;       // 宣告變數
 134          void play(char *,char *);// 宣告節拍函數
 135          void beat(char);                // 宣告節拍函數
 136          void DELAY(int);        // 宣告延時函數
 137          // ==================================================
 138          main()
 139          {       Buzzer=1;                       // 初始化
 140   1              KEY=0xff;                       // 初始化
 141   1              IE=0x82;                        // 啟用Timer 0中斷
 142   1              TMOD=TMOD|1;            // 設定Timer 0 Mode 1
 143   1              while(1)                        // 無窮盡迴圈
 144   1              {       switch (~KEY)           // 讀取按鍵
 145   2                      {       case 0x01:
 146   3                              {       ptr1=&song1[0];ptr2=&beat1[0];
 147   4                                      play(ptr1,ptr2);break;  
 148   4                              }
 149   3                              case 0x02:
 150   3                              {       ptr1=&song2;ptr2=&beat2;
 151   4                                      play(ptr1,ptr2);break;  
 152   4                              }
 153   3                              case 0x04:
 154   3                              {       ptr1=&song3;ptr2=&beat3;
 155   4                                      play(ptr1,ptr2);break;  
 156   4                              }
 157   3                              case 0x08:
 158   3                              {       ptr1=&song4;ptr2=&beat4;
 159   4                                      play(ptr1,ptr2);break;  
 160   4                              }
 161   3                              case 0x10:
 162   3                              {       ptr1=&song5;ptr2=&beat5;
 163   4                                      play(ptr1,ptr2);break;  
 164   4                              }
 165   3                              case 0x20:
 166   3                              {       ptr1=&song6;ptr2=&beat6;
 167   4                                      play(ptr1,ptr2);break;  
 168   4                              }
 169   3                              case 0x40:
 170   3                              {       ptr1=&song7;ptr2=&beat7;
 171   4                                      play(ptr1,ptr2);break;  
 172   4                              }
 173   3                              case 0x80:
 174   3                              {       ptr1=&song8;ptr2=&beat8;
 175   4                                      play(ptr1,ptr2);break;  
 176   4                              }
 177   3                      }
 178   2              }       
 179   1      }
C51 COMPILER V9.01   A1                                                                    02/11/2012 12:09:02 PAGE 4   

 180          // ==================================================
 181          void play(char *x,char *y)
 182          {       char i=0;               // 播音指標
 183   1              while(*(x+i)!=100)
 184   1              {       TH0=t0H=(65536-BaseTone[*(x+i)])/256;
 185   2                      // 載入所要播音階之高8位元
 186   2                      TL0=t0L=(65536-BaseTone[*(x+i)])%256;
 187   2                      // 載入所要播音階之低8位元
 188   2                      TR0=1;                          // 發音
 189   2                      beat(*(y+i));           // 節拍
 190   2                      TR0=0;                          // 停止發音
 191   2                      if(~KEY!=0) break;      // 偵測按鍵 
 192   2                      i++;                            // 下一個音
 193   2              }
 194   1      }
 195          // ==================================================
 196          void beat(char x)
 197          {       char i;
 198   1              for (i=0;i<x;i++)
 199   1                      DELAY((B0-23)/12);      
 200   1      }       
 201          // ==================================================
 202          void DELAY(int x)
 203          {       int i;
 204   1              for(i=0;i<x;i++);
 205   1      }
 206          // ==================================================
 207          void TONE_int(void) interrupt 1
 208          {       TH0=t0H; TL0=t0L;// 重新填入計時量
 209   1              Buzzer=!Buzzer;         // 切換蜂鳴器
 210   1      }
 211          //============================================


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    527    ----
   CONSTANT SIZE    =    992    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     10       9
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
