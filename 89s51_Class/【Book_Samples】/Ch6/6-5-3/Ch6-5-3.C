#include <reg51.h>
#define  B0 50000			// 定義基本節拍
#define  KEY P2				// 定義按鍵位址
sbit Buzzer=P3^7;			// 宣告蜂鳴器位址 
// ========================================
int code BaseTone[37]={	// 宣告基本音階陣列
	1,956,852,759,716,638,568,506,1,1,1,
	1908,1701,1515,1433,1276,1136,1012,1,1,1,
	478,426,379,358,319,284,253,1,1,1,
	903,804,1,676,602,	526	};
// ========================================
// 平安夜,聖誕夜 音調表 
char code song1[]={
	5,6,5,3,  	5,6,5,3, 	2,22,7,			21,21,5,	//1
	6,6,21,7,6, 5,6,5,3,	6,6,21,7,6,	5,6,5,3	,	//2
	22,22,24,22,7, 21,23,	21,5,3,5,4,2, 	1,1, 100};	//3
// 平安夜,聖誕夜 節拍表 
char code beat1[]={
	6,2,4,16,  	6,2,8,12, 	8,4,16,		8,4,16,		//1
	8,8,6,2,8, 	6,2,8,16,	8,4,6,2,4,	6,2,4,16,	//2
	8,4,6,2,4, 	16,16,		6,2,4,6,2,8,16,16}	;	//3
// ========================================
// 甜蜜的家庭 音調表  
char code song2[]={
	1,2,		3,4,4,5, 	5,3,5,		4,3,4,2,2,	//1	
	3,1,2,		3,4,4,5, 	5,3,5,		4,3,4,2	,	//2
	1,0,5,5,	21,7,6,5,	5,3,5,5,	4,3,4,2	,	//3
	3,5,5,		21,7,6,5,	5,3,5,5,	4,3,4,2	,	//4
	1,0,		5,  		4,2,		1, 			//5
	2, 			3,0,5,  	21,7,6,5,	5,3,5,5,	//6
	4,3,4,2,	1,     100};						//7
// 甜蜜的家庭 節拍表 
char code beat2[]={
	12,4,		12,4,12,4, 	16,8,8,		12,4,8,4,4,//1
	24,6,2,		12,4,12,4,	16,8,8,		12,4,8,8,	//2
	16,8,4,4,	12,4,12,4, 16,8,4,4,	12,4,8,8,	//3
	24,4,4,		12,4,12,4, 	16,8,4,4,	12,4,8,8,	//4
	24,8,  		32, 		16,16,		32,	 		//5
	32,  		16,8,8, 	12,4,12,4,	16,8,4,4,	//6
	12,4,8,8,	32 };								//7
// ========================================
// You are my Sunshin 音調表 
char code song3[]={
	15,1,2,  	3,3, 	3,33,2,3,	1,1,		//1	
	1,1,2,3,  	4,6, 	6,6,5,4,	3,0,		//2
	3,1,2,3,	4,6,  	6,6,5,4,	3,1,		//3
	1,15,1,2, 	3,4,	2,2,3,1,	1,0, 100};	//4
// You are my Sunshin 節拍表 
char code beat3[]={
	4,4,4,  	8,8, 	4,4,4,4,	8,8,	//1
	4,4,4,4,  	8,8, 	4,4,4,4,	12,2,	//2
	4,4,4,4,  	8,8, 	4,4,4,4,	8,8,	//3
	4,4,4,4,  	12,4, 	8,4,4,		12,2};	//4
//========================================
// 點仔膠 音調表 
char code song4[]={
	6,6,6,  	5,3,6, 	22,21,22,	6,5,6,				//1	
	21,21,22,23,23,22,22,21,21,6,6, 5,7,6,  100};	//2
// 點仔膠 節拍表 
char code beat4[]={
	4,4,6,  	4,4,6, 	4,4,6,		4,4,6,		//1
	4,4,6,2,  	4,4,6, 	4,4,4,4,	4,4,6};		//2
//========================================
// 西北雨 音調表 
char code song5[]={ 
	6,21,6,  	5,3,6, 	2,2,1,2,	1,15,16,		//1	
	2,2,3,5,  	1,5,6, 	5,5,3,5,	2,3,2,			//2	
	1,16,15,16,1,1,1, 	5,5,3,5,	21,5,6,			//3	
	21,21,21,3,5,6,5,	2,3,2, 		17,15,16,100};	//4
// 西北雨 節拍表 
char code beat5[]={
	4,4,8,  	4,4,8, 	4,4,6,2,	4,4,8,		//1
	4,4,6,2,  	4,4,8, 	4,4,6,2,	4,4,8,		//2
	4,4,6,2,  	4,4,8, 	4,4,6,2,	4,4,8,		//3
	4,4,6,2,  	4,4,8, 	4,4,8,		4,4,8};		//4
//========================================
// 青蚵嫂 音調表
char code song6[]={ 
	16,16,1,2,3,2,  	1,16,1,2,13, 			//1	
	15,13,15,16,1,16,2, 1,16,15,13,15,16,	//2	
	16,16,1,2,3,2,  	1,16,1,2,13, 			//3	
	15,13,15,16,1,16,2, 1,16,15,13,15,16, 	//4	
	15,13,15,16,1,16,2, 1,16,15,13,15,16,	100	};//5	
// 青蚵嫂 節拍表 
char code beat6[]={
	4,4,2,2,12,4,  		8,4,4,4,16,		//1
	4,4,4,2,2,12,4,		4,4,4,2,2,16,		//2
	4,4,2,2,12,4,  		4,4,4,4,16,		//3
	4,4,4,2,2,12,4,		4,4,4,2,2,16,		//4
	4,4,4,2,2,12,4,		4,4,4,2,2,16};		//5
//========================================
// 寄語白雲 音調表
char code song7[]={ 
	15,15,15,0,1,17,1,  	2,2,3,		//1	
	4,4,4,4,3,1,3,  		2,			//2	
	5,5,5,6,6,6,6,  		5,4,3,2,	//3	
	15,15,15,15,15,4,3,2,	1,			//4	
	6,6,6,4,  				21,6,5,		//5	
	6,4,21,6,				5,			//6	
	4,4,4,3,4,				5,3,2,1,	//7	
	2,2,2,7,7,7,6,			5, 	100};	//8	
// 寄語白雲 節拍表 
char code beat7[]={
	8,4,4,4,4,4,4,  	12,4,16,	//1
	8,4,4,4,8,2,2,		32,			//2
	8,4,4,4,4,4,4,		8,4,4,16,	//3
	4,4,4,4,4,4,4,4,	32,			//4
	12,4,8,8,			8,8,16,		//5
	8,8,8,8,			32,			//6
	12,4,8,4,4,		8,4,4,8,	//7
	8,4,4,4,4,4,4,		32};		//8
//========================================		
// 茉莉花 音調表
char code song8[]={ 
	3,3,5,  	6,21,21,6, 	5,5,6,	5,0, 		//1	
	3,3,5,  	6,21,21,6, 	5,5,6,	5,0, 		//2
	5,5,  		5,3,5,  	6,6,	5,0, 		//3
	3,2,3, 		5,3,2,		1,1,2,	1,0, 		//4
	3,2,1,		3,2,3,  	5,6,21,	5, 			//5
	2,3,5, 		2,3,1,16,  	15,		16,1, 		//6
	2,3,  		1,2,1,16,	15,     0, 100}; 	//7
// 茉莉花 節拍表 
char code beat8[]={
	8,4,4,  	4,4,4,4, 	8,4,4,		8,4, 	//1
	8,4,4,  	4,4,4,4, 	8,4,4,		8,4, 	//2
	8,8,  		8,4,4, 		8,8,		8,4, 	//3
	8,4,4,  	8,4,4, 		8,8,		8,4, 	//4
	4,4,4,4,  	12,4, 		8,4,4,		16,	 	//5
	8,4,4,  	4,4,4,4, 	16,			8,8, 	//6
	12,4,  		4,4,4,4, 	16,			4 };	//7
// ==================================================
int t0H,t0L;		// 宣告變數
char *ptr1,*ptr2;	// 宣告變數
void play(char *,char *);// 宣告節拍函數
void beat(char); 		// 宣告節拍函數
void DELAY(int); 	// 宣告延時函數
// ==================================================
main()
{	Buzzer=1;	  		// 初始化
	KEY=0xff;	  		// 初始化
	IE=0x82;	  		// 啟用Timer 0中斷
	TMOD=TMOD|1;	  	// 設定Timer 0 Mode 1
	while(1)	  		// 無窮盡迴圈
	{	switch (~KEY)		// 讀取按鍵
		{	case 0x01:
			{	ptr1=&song1[0];ptr2=&beat1[0];
				play(ptr1,ptr2);break;	
			}
			case 0x02:
			{	ptr1=&song2;ptr2=&beat2;
				play(ptr1,ptr2);break;	
			}
			case 0x04:
			{	ptr1=&song3;ptr2=&beat3;
				play(ptr1,ptr2);break;	
			}
			case 0x08:
			{	ptr1=&song4;ptr2=&beat4;
				play(ptr1,ptr2);break;	
			}
			case 0x10:
			{	ptr1=&song5;ptr2=&beat5;
				play(ptr1,ptr2);break;	
			}
			case 0x20:
			{	ptr1=&song6;ptr2=&beat6;
				play(ptr1,ptr2);break;	
			}
			case 0x40:
			{	ptr1=&song7;ptr2=&beat7;
				play(ptr1,ptr2);break;	
			}
			case 0x80:
			{	ptr1=&song8;ptr2=&beat8;
				play(ptr1,ptr2);break;	
			}
		}
	}	
}
// ==================================================
void play(char *x,char *y)
{	char i=0;		// 播音指標
	while(*(x+i)!=100)
	{	TH0=t0H=(65536-BaseTone[*(x+i)])/256;
	 	// 載入所要播音階之高8位元
		TL0=t0L=(65536-BaseTone[*(x+i)])%256;
	 	// 載入所要播音階之低8位元
		TR0=1;				// 發音
		beat(*(y+i));		// 節拍
		TR0=0; 				// 停止發音
		i++;				// 下一個音
	}
}
// ==================================================
void beat(char x)
{	char i;
	for (i=0;i<x;i++)
		DELAY((B0-23)/12);	
}	
// ==================================================
void DELAY(int x)
{	int i;
	for(i=0;i<x;i++);
}
// ==================================================
void TONE_int(void) interrupt 1
{	TH0=t0H; TL0=t0L;// 重新填入計時量
	Buzzer=!Buzzer; 	// 切換蜂鳴器
}
//============================================
